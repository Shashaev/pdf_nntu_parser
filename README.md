# PDF_NNTU_Parser

## О проекте

Проект представляет собой сервис для сбора и обработки информации с [официального сайта НГТУ им. Р.Е. Алексеева](https://www.nntu.ru). В данный монет акцент смещен в сторону информации об [учебный планах и РПД](https://www.nntu.ru/sveden/education/). Для удобного получения собранной информации было сделано API.

## Принцип работы парсера

Чтобы поддерживать *актуальность данных* при запуске программы стартует **событийный цикл**, который исполняет различные **события** с определенной частотой.

*Событие* - функция, которая обёрнута в декоратор `registration.run`.

Декоратор имеет следующую структуру:
```python
def run(
    max_count: int = 1,
    delay_time: float = 0,
    endless_execution: bool = False,
):
```
Принимаемые параметры:
- max_count: определяет максимальное кол-во раз, которое будет вызвана функция
- delay time: указывает на задержку (*в секундах*), которая будет сделана между вызовами функции
- endless execution: если функцию нужно исполнять без ограничения в кол-ве раз, то ставиться значение `True`

Все *события* собраны в папке `src/parsing app/events` и разделены на несколько групп:
1. События для парсинга сайта - `events/web pages`.
2. События для парсинга информации из **pdf файлов** - `events/pdf`
3. События для постобработки полученных данных - `events/post_processing`

Событие исполняются только при импорте их модуля, если вам не нужно исполнения конкретных событий или их групп, то можете закомментировать импорт в файлах:
- `parsing_app/events/__init__.py`
- `parsing_app/events/pdf/__init__.py`
- `parsing_app/events/web_pages/__init__.py`
- `parsing_app/events/post_processing/__init__.py`

Все данные, которые будут получены, кроме *pdf файлов* (они складываются в отдельную папку `src/parsing app/data/pdf`), будут добавлены, и вследствии храниться, в *БД* (по умолчанию используется **SQLite**).

Для *изменения настроек путей* или использования **другой БД**, нужно изменить параметры в файле `parsing app/settings.py`.

Так присутствуют настройки:
- **PATH_ROOT**: путь, от которого будут откладываться все остальные, *по умолчанию* это путь до папки, в которой находиться файл с настройками
- **PATH DATA**: путь до папки с данными, которые будут получены в результате работы программы
- **PATH_PDF**: путь до папки, в которую будут складываться все pdf файлы
- **PATH_PDF_EDUCATIONAL_PROGRAM**: путь до папки, в которую будут складываться pdf файлы программ обучения
- **PATH_PDF_RPD**: путь до папки, в которую будут складываться pdf файлы РПД
- **USE POSTGRESQL**: флаг, если `False`, то используется **SQLite**, иначе **PostgreSQL** (но для этого нужно определить следующие параметры)
- **DB_USER**: имя пользователя в БД PostgreSQL
- **DB_PASSWORD**: пароль от пользователя
- **DB_HOST**: хост PostgreSQL
- **DB_PORT**: порт
- **DB_NAME**: имя БД
- **API CATALOG**: идентификатор каталога у **Yandex Cloud**
- **API_TOCKEN**: токен для **Yandex Cloud**

Для работы выделения связей из РПД нужно настроить параметры **API CATALOG**, **API_TOCKEN**.
Рекомендованный для этого способ - создание в корне проекта файла `.env` с параметрами по примеру в `.env.example`. Парамеры можно получить следую [этому руководству](https://habr.com/ru/articles/780008/).

Пути откладываются относительно настроек более высокого уровня. К примеру, при сохранении РПД будет использоваться папка по следующему пути - `PATH_ROOT / PATH_DATA / PATH_PDF / PATH_PDF_RPD`.

## Что нужно для запуска?
- [Git](https://git-scm.com/downloads)
- [Python>=3.10](https://www.python.org/downloads/)
- [Microsoft Visual C++ Redistributable](https://aka.ms/vs/16/release/vc_redist.x64.exe)

## Запуск проекта
1. Клонирование репозитория с github
```bash
git clone https://github.com/Shashaev/pdf_nntu_parser.git
```
2. Переход в корень проекта
```bash
cd PDF NBU PARSER
```
3. Создание виртуального окружения
- **Windows**
```bash
    python -m venv venv
```
   - **Linux/macOS**
```bash
    python3 -m venv venv
```
4. Активация виртуального окружения
  - **Windows**
```bash
    venv\Scripts\activate
```
  - **Linux/macOS**
```bash
    source venv/bin/activate
```
5. Установка зависимостей
```bash
pip install -r requirements.txt
```
6. Запуск работы
- **Windows**
```bash
    python src/parsing_app/main.py
```
- **Linux/macOS**
```bash
    python3 src/parsing_app/main.py
```

## API

Для удобного доступа в данным было сделано API. Оно использует полученную в результате парсинга БД.
Так как парсинг всех данный занимает довольно продолжительное время, то можно использовать готовую БД. [Ссылка на БД (актуально на момент 20.08.2025)](https://drive.google.com/file/d/10cWmI4gxs3Y68R5iEPv8EzqOqMD53f91/view?usp=sharing). Её нужно поместить в папку `parsing_app/data`, если она там уже есть, то нужно заменить.

### Запуск

После прохождение шагов 1-5 из прошлой инструкции нужно выполнить команду:
- **Windows**
```bash
    python src/api app/main.py
```
- **Linux/macOS**
```bash
    python3 src/api_app/main.py
```

После запуститься приложение предоставляющее API. Приложение написано на фреймворке **FastAPI**, поэтому доступна [удобочитаемая и инероктивная докумендация](http://127.0.0.1:8000/docs).